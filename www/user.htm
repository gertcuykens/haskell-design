<!DOCTYPE html>
<!-- Copyright(c) gert.cuykens@gmail.com -->
<html>
 <head>
  <title>user</title>
  <link type="text/css" href="user.css" rel="stylesheet"/>
  <script src="http.js"></script>
 </head>
 <body>

  <form name="user" action="javascript:ws.send(JSON.stringify(formJSON(document.user)));
                                       console.log(JSON.stringify(formJSON(document.user)))">
   <label>city:</label>    <input name="city"   /><br/>
   <label>country:</label> <input name="country"/><br/>
   <label>phone:</label>   <input name="phone"  /><br/>
   <label>email:</label>   <input name="email"  /><br/>
   <input type="submit" value="update"/>
  </form>

  <script>
   try{var code = document.URL.match('code=.*')[0].replace(/^.*code=/,'')}
   catch(e){var code = 'facebook'}

   var ws = createWebSocket(':9161')
   ws.onopen = function(){ws.send('Facebook Code '+ code)}
   ws.onmessage = function(event){
    if (event.data.match('^Facebook Login ')){
        document.location=event.data.match('https.*')+'&state=user'
        return true
    }
    console.log(event.data)
    JSONform(document.user,JSON.parse(event.data))
   }

   var img=document.createElement('img')
   img.setAttribute('id','picture')
   img.setAttribute('alt','picture')
   img.setAttribute('src','picture.png')
   dropBoxWS(ws,img)
   document.body.appendChild(img)
  </script>

 </body>
</html>
